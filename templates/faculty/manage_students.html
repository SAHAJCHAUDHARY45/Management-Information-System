{% extends 'base.html' %}
{% block content %}
<div class="container-fluid px-2 px-md-4 py-4">
  <!-- Quick Stats -->
  <div class="row mb-4 g-3">
    <div class="col-12 col-md-4">
      <div class="card text-center shadow-sm border-0 h-100">
        <div class="card-body">
          <h6 class="text-muted">Total Students</h6>
          <h2 class="fw-bold text-primary">{{ total_students }}</h2>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="card text-center shadow-sm border-0 h-100">
        <div class="card-body">
          <h6 class="text-muted">Total Results</h6>
          <h2 class="fw-bold text-success">{{ total_results }}</h2>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="card text-center shadow-sm border-0 h-100">
        <div class="card-body">
          <h6 class="text-muted">Latest Announcement</h6>
          {% if announcements and announcements|length > 0 %}
            <div class="small fw-bold">{{ announcements.0.title }}</div>
            <div class="text-muted small">{{ announcements.0.created_at|date:"M d, Y" }}</div>
          {% else %}
            <div class="text-muted">No announcements</div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  <!-- Tab Navigation -->
  <ul class="nav nav-pills mb-4 justify-content-center" id="manageTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="students-tab" data-bs-toggle="pill" data-bs-target="#students" type="button" role="tab">Students</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="results-tab" data-bs-toggle="pill" data-bs-target="#results" type="button" role="tab">Results</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="announcements-tab" data-bs-toggle="pill" data-bs-target="#announcements" type="button" role="tab">Announcements</button>
    </li>
  </ul>
  <div class="tab-content" id="manageTabsContent">
    <!-- Students Tab -->
    <div class="tab-pane fade show active" id="students" role="tabpanel">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-3 gap-2">
        <h3 class="mb-0">Manage Students</h3>
        <a href="{% url 'add_student' %}" class="btn btn-primary w-100 w-md-auto"><i class="fas fa-user-plus me-2"></i>Add Student</a>
      </div>
      <form method="get" class="mb-3">
        <div class="input-group">
          <select name="department" class="form-select">
            <option value="">All Departments</option>
            {% for value, label in departments %}
              <option value="{{ value }}" {% if selected_department == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
          <button type="submit" class="btn btn-outline-primary">Filter</button>
        </div>
      </form>
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light sticky-top">
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Roll Number</th>
              <th>Phone</th>
              <th>Department</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for student in students %}
            <tr>
              <td>{{ student.user.first_name }} {{ student.user.last_name }}</td>
              <td>{{ student.user.email }}</td>
              <td>{{ student.roll_number }}</td>
              <td>{{ student.phone_number }}</td>
              <td>{{ student.get_department_display }}</td>
              <td>
                <a href="{% url 'edit_student' student.id %}" class="btn btn-sm btn-outline-warning" title="Edit"><i class="fas fa-edit"></i></a>
                <a href="{% url 'delete_student' student.id %}" class="btn btn-sm btn-outline-danger" title="Delete"><i class="fas fa-trash"></i></a>
                <a href="{% url 'assign_subjects' student.id %}" class="btn btn-sm btn-outline-info" title="Assign Subjects"><i class="fas fa-book"></i></a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <!-- Results Tab -->
    <div class="tab-pane fade" id="results" role="tabpanel">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-3 gap-2">
        <h3 class="mb-0">Manage Results</h3>
        <a href="{% url 'add_result' %}" class="btn btn-success w-100 w-md-auto"><i class="fas fa-plus me-2"></i>Add Result</a>
      </div>
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light sticky-top">
            <tr>
              <th>Student</th>
              <th>Subject</th>
              <th>Marks</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for result in results %}
            <tr>
              <td>{{ result.student.user.first_name }} {{ result.student.user.last_name }} ({{ result.student.roll_number }})</td>
              <td>{{ result.subject.code }} - {{ result.subject.name }}</td>
              <td>{{ result.marks }}</td>
              <td>
                <a href="{% url 'edit_result' result.id %}" class="btn btn-sm btn-outline-warning" title="Edit"><i class="fas fa-edit"></i></a>
                <a href="{% url 'delete_result' result.id %}" class="btn btn-sm btn-outline-danger" title="Delete"><i class="fas fa-trash"></i></a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <!-- Announcements Tab -->
    <div class="tab-pane fade" id="announcements" role="tabpanel">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-3 gap-2">
        <h3 class="mb-0">Manage Announcements</h3>
        <a href="{% url 'create_announcement' %}" class="btn btn-info w-100 w-md-auto"><i class="fas fa-bullhorn me-2"></i>Create Announcement</a>
      </div>
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light sticky-top">
            <tr>
              <th>Title</th>
              <th>Content</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for announcement in announcements %}
            <tr>
              <td>{{ announcement.title }}</td>
              <td>{{ announcement.content|truncatewords:15 }}</td>
              <td>{{ announcement.created_at|date:"M d, Y" }}</td>
              <td>
                <a href="{% url 'announcement_list' %}" class="btn btn-sm btn-outline-info" title="View"><i class="fas fa-eye"></i></a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %} 